<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Non Conformities List
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-searchbar 
    [(ngModel)]="searchQuery" 
    (ionInput)="filterNC()" 
    aria-label="Search non conformities" 
    debounce="500">
  </ion-searchbar>

  <div class="container">
    <!-- Icône de filtre -->
    <div class="icon-filter">
      <ion-icon name="funnel-outline"></ion-icon>  
    </div>

    <!-- Boutons "Réelle" et "Potentielle" avec icône "plus" -->
    <div class="buttons-container">
      <ion-button class="reelle-button" (click)="goToCreationNonConformity('reelle')">
        <ion-icon slot="start" name="add"></ion-icon>
        Réelle
      </ion-button>
      <ion-button class="potentielle-button" (click)="goToCreationNonConformity('potentielle')">
        <ion-icon slot="start" name="add"></ion-icon>
        Potentielle
      </ion-button>
    </div>
  </div>
  
  
  <div *ngIf="filteredNCList.length > 0">

    <div *ngFor="let NonConformity of filteredNCList; trackBy: trackById">
      <ion-card class="NC-card">
        <div class="state-indicator" [ngClass]="getStateColor(NonConformity.stateStr)">
          <span class="state-text">{{ NonConformity.stateStr || 'N/A' }}</span>
        </div>

        <div class="card-content">
          <ion-card-header>
            <ion-card-title>Reference: {{ NonConformity.reference || 'N/A' }}</ion-card-title>
          </ion-card-header>
          
          <ion-card-content>
            <div class="right-labels">
              <span class="badge">{{ NonConformity.nonConformityNatureStr || 'N/A' }}</span>
              <span class="badge">{{ NonConformity.nonConformitySourceStr || 'N/A' }}</span>
            </div> 
            <div class="source-container">
              <div class="source-ref">
                <strong>Source Ref:</strong> {{ NonConformity.referenceSource || 'N/A' }}
              </div>
              <div class="NC-system">
                {{ NonConformity.system || 'N/A' }}
              </div>
            </div>
            <div class="intensity-container" [ngClass]="getIntensityClass(NonConformity.intensityDesignation)">
              <ion-icon name="warning" class="intensity-icon"></ion-icon>
              <div class="IntensityDes">
                {{ NonConformity.intensityDesignation || 'N/A' }}
              </div>
            </div>            
            <div class="designation">
              {{ NonConformity.designation || 'N/A' }}
            </div>
            <div class="icon-actions">
              <div class="icon-box chat-icon">  
                <ion-icon name="chatbubble-ellipses-outline"></ion-icon>  
              </div> <!-- Messagerie -->
              <ion-icon name="construct-outline" class="action-icon"></ion-icon>  <!-- Actions de correction -->
              <ion-icon name="search-circle-outline" class="action-icon"></ion-icon>  <!-- Analyse de causes -->
              <ion-icon name="eye-outline" class="action-icon"></ion-icon>  <!-- Visualisation -->
            </div>            
          </ion-card-content>
        </div>
      </ion-card>
    </div>
  </div>


  <div *ngIf="filteredNCList.length === 0">
    <p>No Non Conformities logs available.</p>
  </div>

  <div *ngIf="!isAuthenticated">
    <p>You need to log in to see Non Conformities logs.</p>
  </div>

  <ion-button style="font-size: 14px; padding: 6px 12px; margin-left: 0;" color="danger" (click)="logoutUser()">Logout</ion-button>

</ion-content>


